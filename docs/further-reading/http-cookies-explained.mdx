---
id: http-cookies-explained
title: HTTP Cookies Explained
---

Whenever the client is a browser, Ory uses HTTP cookies to store the session states and to protect against attack vectors such as
CSRF. Ory issues HTTP Cookies with the following flags for the highest level of security:

1. `secure`: The cookie is only sent over HTTPS connection to protect against man-in-the-middle attacks;
2. `httpOnly`: The Cookie is not available to JavaScript code to protect against XSS;
3. `sameSite=Strict`: The Cookie can only be requested from the same origin to protect against CSRF attacks;

#### HTTP Cookie Domains

When the server sets a cookie, it defines the `domain` the cookie is valid for:

```
Set-Cookie: <name>=<value>; domain=<domain>
```

At Ory, this value defaults to the domain of your project (`<project>.projects.oryapis.com`). The browser only accepts cookies
from the same domain. If you make a request to `https://www.my-evil-app.com` and the server responds with

```
Set-Cookie: google_session=1234; domain=google.com
```

the browser of course rejects the cookie! The same applies when you make a request in the browser. It will only send the cookie if
the domain matches. Making a request to `https://www.my-evil-app.com` will **never** send cookies set for `google.com`.

The rules of when a browser accepts or rejects are as follows:

1. A cookie set with `Set-Cookie: <name>=<value>; domain=example.org` will be sent in requests to `example.org` and all subdomains
   of example.org (`www.example.org`, `api.example.org`, ...);
1. A cookie set with `Set-Cookie: <name>=<value>; domain=api.example.org` will be sent to `api.example.org` and its subdomains
   (`service.api.example.org`, ...) but not to `example.org` or `not-api.example.org`;
1. Cookies do not care about the port number. A cookie set with `Set-Cookie: <name>=<value>; domain=example.org:1234` will be sent
   to `https://example.org:443`, `http://example.org:80`, `http://api.example.org:1234`, ...;

#### Cross-Origin HTTP Cookies

When working with Single Page Apps, we often use AJAX requests to fetch data from the server. There are three cross-origin types
of AJAX requests:

1. On the same domain: the browser address bar is `https://www.example.org` and the AJAX request goes to
   `https://www.example.org/api/...`;
2. On the same top-level-domain: the browser address bar is `https://www.example.org` and the AJAX request goes to
   `https://api.example.org/api/...`;
3. On another top-level-domain: the browser address bar is `https://www.example.org` and the AJAX request goes to
   `https://api-example.com/...`;

##### Same-Domain

This just works - there is no extra work to do.

##### Same Top-Level-Domain

This only works if the server at `api.example.org` responds with the appropriate
[CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) headers

and when the JavaScrip XHR request is made with `withCredentials: true`

##### Cross Top-Level-Domain

Sending cookies cross top-level-domains worked in the past, but is being deprecated on most browsers to improve data privacy.
Cross-domain cookies have been abused for user tracking and advertisement. Here is a list of browser who have phased out
cross-domain cookies already or who are planning to do so:

1. [Safari blocks cross-domain cookies per default](https://www.infoq.com/news/2020/04/safari-third-party-cookies-block/);
2. [Chrome blocks cross-domain cookies in incognito mode](https://www.adexchanger.com/privacy/google-will-limit-cross-site-tracking-in-chrome-by-default-starting-in-february/);
